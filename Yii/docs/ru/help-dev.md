# Dev-help

На этой странице описывается расширение текущего приложения; также она содержит
много болтовни.

## Yii

Это приложение быо построено на основе Yii 1.1.15. Это означает, что оно может
быть расширено в любом поддерживаемом Yii виде - расширения, виджеты,
произвольные параметры в конфигурации.  
Приложение было написано, как часть проекта, призванного познакомить конечного
разработчика со стеком фреймворков, поэтому любые модификации, исследования
запчастей, распиливание по кускам и тест приложения на прочность не только
разрешены, но и приветствуются.  
Единственное, что необходимо упомянуть - файл конфигурации перезаписывается
каждый раз, когда обновляется имя или язык приложения на 
[странице настроек](/admin/options), поэтому любые комментарии оттуда исчезнут
(любые значения, однако, сохранятся).

## Темы

Как было упомянуто выше, приложение работает на основе Yii, и на него
распространяются
[стандартные правила](http://www.yiiframework.com/doc/guide/1.1/en/topics.theming)
(за исключение использования Twig). При написании новой темы будет необходимо
поместить новые файлы в папку `public/skins/название-темы` и активировать
тему, выбрав ее на [странице настроек](/admin/options) или указав
`theme => 'название-темы'` в файле конфигурации. После этого вы можете
перегрузить шаблоны по умолчанию, расположив свои в папке
`public/skins/название-темы/views` (размещенные шаблоны будут перегружать
одноименные шаблоны по умолчанию). Вы также можете пользоваться дополнительными
css/js файлами, расположенными внутри папки темы: главная страница сайта
соответствует папке приложения `public`.  
Последнее, что необходимо сказать: некоторые части основного шаблона вынесены в
`views/chunks`, что позволяет переопределить их, не растряхивая все дерево
наследования шаблонов.

## Нормальный кэш

Приложение использует кэширование в файл по умолчанию, и это определенно не
рекомендуемое решение. Чтобы использовать другой тип кэширования, откройте файл
`config/web.php` и обновите настройки кэша согласно
[документации Yii](http://yiiframework.ru/doc/guide/ru/caching.overview).

## Впрс? Отвт.

### В: В Yii принято рендерить шаблоны в лейауте с помощью переменной `$content`. Где это, почему я не вижу такого в шаблонах?

**О**: Потому что такая штука, к сожалению, не позволила бы мне полностью
воспользоваться наследованием Twig. Because it wouldn't let me use twig inheritance. Layout template can
access controller, but can't receive data as usual template from `render()`
method. At one moment i've realized that i don't want to put pagination widget
separately in any template that needs it and it easier just to suppress
pagination generation when no data has arrived. So long story short: Twig made
me do it.

### В: Оригинальные требования BlogMVC предполагали написание приложения, выполняющего *только* запрошенный минимум. Зачем ты написал какую-то махину?

**О**: Если честно, мне нужно было закинуть хоть что-нибудь стоящее на мой
[гетхаб](https://github.com/etki). Мне нужно было что-то настолько законченное,
насколько это возможно, поэтому я взял относительно простое ТЗ, сдул пыль с
инстанса [PHP CI](https://github.com/Block8/PHPCI), выучил 
[Codeception](https://github.com/Codeception/Codeception), прицепил
[Twig](https://github.com/fabpot/Twig), прогнал всевозможные тесты, и стал
полировать проект, сделал тесты для миграций на разных движках БД, сделал тест
для недопуска пропущенных переводов и пинал проект, пока хватало времени.  
Я пытался сделать из этого приложения не что-то, что будет *запускаться*, а
что-то, чем можно *пользоваться*.

### В: Зачем ты форматируешь даты в PHP, чтобы достать какие-то данные из БД? Все ровные пацаны пользуются встроенными функциями БД.

**О**: Я бы с радостью, но PostgreSQL меня добил. Я пытался использовать простые
функции текущей даты/времени типа `CURDATE()`, но PostgreSQL банил мой каждый
шаг - каждое решение оказывалось почему-то слегка несовместимым (доходило до
того, что команда работала из консоли, но отказывалась запускаться из Yii);
возможно, я просто схватил где-то по пути тупака и что-то упустил. Вы можете
ознакомиться с моими попытками сделать унифицированный адаптер бд в файле
`components/services/DatabaseService.php`.

### В: Зачем так много геттеров? Почему я их вижу там, где они не нужны?

**О**: Давайте признаем: PHP **всегда** был ярким параноиком. "А что если мне
тут переменную поменяют? А если вышележащий уровень захочет вызвать ошибку?" На
самом деле многие из этих геттеров не нужны (на момент последней редакции файла
многие из них наверняка и исчезли), но я просто старался следовать общей
негласной конвенции. Я ни в коем случае не верю, что это как-то защищает
приложение, но и особого вреда это не наносит.

### В: Почему ты не использовал Yiistrap или Yiibooster?

**О**: Yiistrap сговорился с PostgreSQL и повел себя аналогично, я даже не смог
запустить демо, в то время как Yiibooster запросил PHP 5.4.0+ (а весь проект
писался с ориентировкой на 5.3.0+). Так что я забанил обоих и сделал все руками.

### В: Ты тут перемудрил, у Yii есть встроенный модуль под это!

**О**: Я, на самом деле, довольно консервативный тип и мне каждый раз все
хочется сделать руками (в ущерб, конечно, времени). Поэтому в паре (а то и
более) мест я умышленно не использовал средства Yii или просто не знал об их
существовании. В то же время, в проекте есть куски кода, которые многократно
переписывались из-за вновь открывавшихся для меня знаний.

### В: Что за чертовщина с указанием корневого неймспейса? Yii же вообще не использует неймспейсы.

**О**: Это действительно так. Эти указания вообще не нужны в проекте, я просто
писал проект, как будто кто-то завтра его может взять и начать кусками вставлять
еще куда-то. Ну, и еще это была прекрасная тренировка на внимательность.

### В: Почему ты называешь прокси как layers?

**О**: Технически это не совсем прокси, но, в любом случае, я долго впытался
вспомнить слово "прокси", и вспомнил его только тогда, когда было уже слишком
поздно и наплевать, поэтому я оставил все как есть.

### В: Твой код местами довольно разношерстен. Почему?

**О**: Это очень печально, но у меня закончилось время и я не смог отрефакторить
все, что надо было. Какой-то код требует дополнительной абстракции, какой-то
повторяется, ajax-поддержка и вовсе брошена на середине, и я, конечно, вижу всю
эту печаль. Я действительно хотел сделать абсолютно образцовый проект, но из-за
отсутствия времени получился просто хороший проект.

### В: А у меня тут еще вопросы / хотел тут предложить / не хотите поговорить о Торвальдсе?

**О**: Скорее всего, я не буду заниматься дальнейшей разработкой этого проекта,
но вы вполне можете со мной сконтактировать через vk [vk](http://vk.com/fikey)
или [twitter](https://twitter.com/flickpicker). Также существует постоянно, но
медленно увеличивающаяся вероятность, что я закончил один из моих персональных
сайтов (или даже оба): [ambinight](http://ambinight.com) и
[etki.name](http://etki.name).